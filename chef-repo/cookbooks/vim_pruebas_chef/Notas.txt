Vamos a escribir algunas recetas que se aseguren de que Vim esté instalado, y usaremos las fuentes o los paquetes oficiales.


1) Ver el fichero "recipes/default.rb" y seguir las instrucciones

2) La manera más adecuada de soportar diversas plataformas con diferentes nombres de paquetes desde Chef es mediante la utilización de la función de ayuda value_for_platform que, a partir de una estructura de datos, nos devuelve un valor correspondiente a la plataforma sobre la que ejecuta la receta. Así, en función de este valor, podremos determinar los paquetes que deberemos instalar en cada plataforma "recipes/package.rb"

3) La instalación a partir del código fuente de vim también sería sencilla ya que, a parte de instalar las dependencias básicas necesarias, lo único que se debe hacer en la receta es descargar la versión deseada del código fuente, y ejecutar el comando make.

4) Abrir el "spec/default_spec.rb" y explicarlo

5) "spec/package_spec.rb" => receta para probar la receta "package.rb"
Esta receta de pruebas es un ejemplo, pero no se ejecuta. Se ejecuta "default" que es la escogida



Para ejecutar las pruebas unitarias, ejecutar el siguiente comando desde la carpeta "vim_pruebas_chef". El archivo "Policyfile.rb" tiene que existir

chef exec rspec  

Probad a poner "default['vim']['install_method'] = 'package'" en el fichero "attributes/default.rb" y ejecutar "chef exec rspec" otra vez

Aparece un "WARN: A source recipe does not exist for the platform_family: debian" porque no existe "debian" en "attributes/source.rb", variable "platform_family"

----------------------------------------------------
PRUEBAS DE INTEGRACION
-------------------------------------------------------
Para verificar la configuración y ver un resumen de todas las instancias disponibles 

kitchen list

Test Kitchen nos está proporcionando cuatro casos: cada suite contra cada plataforma definida en el archivo de configuración. Estas instancias no se han creado aún, así que vamos a escribir algunos casos de prueba para poder probarlos contra estas instancias en el siguiente apartado.

Comprobar el correcto funcionamiento pasando el nombre de la instancia que se quiere probar

kitchen test package-ubuntu-1804